import streamlit as st
import pandas as pd
import random

st.set_page_config(page_title="ğŸ”¥ ë§ì¶¤í˜• ìœ í–‰ íŠ¸ë Œë“œ", layout="wide")

# ------------------ ì‚¬ìš©ì ì…ë ¥ ------------------
st.sidebar.title("âœ¨ ë‚˜ì˜ ì •ë³´ ì…ë ¥")
age_group = st.sidebar.selectbox("ì—°ë ¹ëŒ€ ì„ íƒ", ["10ëŒ€","20ëŒ€","30ëŒ€ ì´ìƒ"])
environment = st.sidebar.selectbox("ì£¼ë³€ í™˜ê²½ ì„ íƒ", ["í•™ìƒ","ì§ì¥ì¸","ì£¼ë¶€","ê¸°íƒ€"])
interests = st.sidebar.multiselect("ê´€ì‹¬ì‚¬ ì„ íƒ", ["ìŒì‹","íŒ¨ì…˜","ë°ˆ","ì¸ë¬¼","ê¸°íƒ€"], default=["ìŒì‹","íŒ¨ì…˜"])
mood = st.sidebar.selectbox("í˜„ì¬ ê¸°ë¶„/ë¶„ìœ„ê¸° ì„ íƒ", ["ì¦ê±°ì›€","í¸ì•ˆí•¨","ìê·¹","íë§","í•™ìŠµ"])

# ------------------ ë°ì´í„° ------------------
categories = {
    "ğŸ” ìŒì‹": {
        "ì œë¡œì½œë¼": {"desc":"ì €ì¹¼ë¡œë¦¬ ì—´í’ê³¼ ê±´ê°• íŠ¸ë Œë“œ", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ìŒì‹"], "mood":["ì¦ê±°ì›€","í¸ì•ˆí•¨"]},
        "í•˜ì´ë³¼": {"desc":"ê°€ë³ê²Œ ì¦ê¸°ëŠ” ìˆ ë¡œ ì¸ê¸°", "age":["20ëŒ€","30ëŒ€ ì´ìƒ"], "env":["ì§ì¥ì¸"], "interests":["ìŒì‹"], "mood":["ìê·¹"]},
        "ì¼ë³¸ ë¼ë©˜": {"desc":"SNS ìŒì‹ ë¦¬ë·°ë¡œ ìœ í–‰", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ìŒì‹"], "mood":["ì¦ê±°ì›€"]},
        "í—¬ìŠ¤ ë³´ì¶©ì œ": {"desc":"ìš´ë™ ì—´í’ìœ¼ë¡œ ìˆ˜ìš” ì¦ê°€", "age":["20ëŒ€","30ëŒ€ ì´ìƒ"], "env":["ì§ì¥ì¸"], "interests":["ìŒì‹"], "mood":["ìê·¹"]},
        "ëª¬ìŠ¤í„° ì—ë„ˆì§€": {"desc":"ê²Œì´ë¨¸Â·ìš´ë™ì¸ ì¤‘ì‹¬ í™•ì‚°", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ìŒì‹"], "mood":["ìê·¹"]}
    },
    "ğŸ‘— íŒ¨ì…˜": {
        "í¬ë¡ìŠ¤": {"desc":"í¸ë¦¬í•¨ê³¼ ê¾¸ì•ˆê¾¸ ìŠ¤íƒ€ì¼", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["íŒ¨ì…˜"], "mood":["í¸ì•ˆí•¨"]},
        "ìŠ¬ë¦¬í¼ íŒ¨ì…˜": {"desc":"ì—¬ë¦„ì²  í¸í•œ ìŠ¤íƒ€ì¼", "age":["10ëŒ€","30ëŒ€ ì´ìƒ"], "env":["í•™ìƒ","ì£¼ë¶€"], "interests":["íŒ¨ì…˜"], "mood":["í¸ì•ˆí•¨"]},
        "ì˜¤ë²„í• ì…”ì¸ ": {"desc":"í™í•œ ê°ì„±", "age":["20ëŒ€"], "env":["ì§ì¥ì¸"], "interests":["íŒ¨ì…˜"], "mood":["ìê·¹"]},
        "ë²„í‚·í–‡": {"desc":"ë ˆíŠ¸ë¡œ+ìŠ¤íŠ¸ë¦¿ íŒ¨ì…˜", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["íŒ¨ì…˜"], "mood":["ì¦ê±°ì›€"]},
        "ìƒŒë“¤": {"desc":"ì—¬ë¦„ì²  í•„ìˆ˜í…œ", "age":["20ëŒ€","30ëŒ€ ì´ìƒ"], "env":["ì§ì¥ì¸","ì£¼ë¶€"], "interests":["íŒ¨ì…˜"], "mood":["í¸ì•ˆí•¨"]}
    },
    "ğŸ¤£ ë°ˆ": {
        "ì§„ë˜ë°°ê¸° ë°ˆ": {"desc":"ì¤‘ë…ì„± ê°•í•œ ë©œë¡œë””", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ë°ˆ"], "mood":["ì¦ê±°ì›€"]},
        "ë¬µì§í•˜ë‹¤ ë°ˆ": {"desc":"ê²Œì„Â·ìŠ¤í¬ì¸  íŒ¨ëŸ¬ë””", "age":["20ëŒ€"], "env":["ì§ì¥ì¸"], "interests":["ë°ˆ"], "mood":["ìê·¹"]},
        "ê°“ìƒ ë°ˆ": {"desc":"ìê¸°ê´€ë¦¬ ì—´í’", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ë°ˆ"], "mood":["í•™ìŠµ","ìê·¹"]},
        "ê´‘ê³ ì†¡ íŒ¨ëŸ¬ë””": {"desc":"TVê´‘ê³  ì˜í–¥", "age":["30ëŒ€ ì´ìƒ"], "env":["ì£¼ë¶€"], "interests":["ë°ˆ"], "mood":["í¸ì•ˆí•¨"]},
        "AI íŒ¨ëŸ¬ë””": {"desc":"í•©ì„± ê¸°ìˆ ë¡œ ë§Œë“  ë°ˆ", "age":["20ëŒ€"], "env":["ì§ì¥ì¸"], "interests":["ë°ˆ"], "mood":["ìê·¹"]}
    },
    "ğŸŒŸ ì¸ë¬¼": {
        "ì´ê°•ì¸": {"desc":"ì•„ì‹œì•ˆì»µ í™œì•½ìœ¼ë¡œ ì¸ê¸°", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ì¸ë¬¼"], "mood":["ìê·¹"]},
        "ë‰´ì§„ìŠ¤ ë¯¼ì§€": {"desc":"K-POP ì¸ê¸°", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ì¸ë¬¼"], "mood":["ì¦ê±°ì›€"]},
        "ì†í¥ë¯¼": {"desc":"EPL í™œì•½ê³¼ SNS í™”ì œ", "age":["20ëŒ€"], "env":["ì§ì¥ì¸"], "interests":["ì¸ë¬¼"], "mood":["ìê·¹"]},
        "ì„ì˜ì›…": {"desc":"íŠ¸ë¡œíŠ¸ ì¸ê¸°", "age":["30ëŒ€ ì´ìƒ"], "env":["ì£¼ë¶€"], "interests":["ì¸ë¬¼"], "mood":["í¸ì•ˆí•¨"]},
        "ì•„ì´ìœ ": {"desc":"ë“œë¼ë§ˆÂ·ìŒì› ì¸ê¸°", "age":["20ëŒ€","30ëŒ€ ì´ìƒ"], "env":["ì§ì¥ì¸","ì£¼ë¶€"], "interests":["ì¸ë¬¼"], "mood":["ì¦ê±°ì›€"]}
    },
    "ğŸ’¡ ê¸°íƒ€": {
        "ì „ë™ í‚¥ë³´ë“œ": {"desc":"ë„ì‹¬ ì´ë™ ìˆ˜ë‹¨", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ê¸°íƒ€"], "mood":["ì¦ê±°ì›€","í¸ì•ˆí•¨"]},
        "ìº í•‘ìš©í’ˆ": {"desc":"ì•¼ì™¸í™œë™ ì¦ê°€", "age":["20ëŒ€","30ëŒ€ ì´ìƒ"], "env":["ì§ì¥ì¸","ì£¼ë¶€"], "interests":["ê¸°íƒ€"], "mood":["í¸ì•ˆí•¨"]},
        "ë“œë¡  ì´¬ì˜": {"desc":"SNS ì˜ìƒ ì œì‘", "age":["10ëŒ€","20ëŒ€"], "env":["í•™ìƒ","ì§ì¥ì¸"], "interests":["ê¸°íƒ€"], "mood":["ì¦ê±°ì›€"]},
        "ìŠ¤ë§ˆíŠ¸í™ˆ ê¸°ê¸°": {"desc":"IoT ê¸°ìˆ  ë°œì „", "age":["20ëŒ€","30ëŒ€ ì´ìƒ"], "env":["ì§ì¥ì¸","ì£¼ë¶€"], "interests":["ê¸°íƒ€"], "mood":["í¸ì•ˆí•¨"]},
        "AR ì•ˆê²½": {"desc":"ë©”íƒ€ë²„ìŠ¤ ì—´í’", "age":["20ëŒ€"], "env":["ì§ì¥ì¸"], "interests":["ê¸°íƒ€"], "mood":["ì¦ê±°ì›€"]}
    }
}

# ------------------ ì ìˆ˜ ìƒì„± ------------------
all_data = []
for cat, items in categories.items():
    for item, info in items.items():
        if age_group in info["age"] and environment in info["env"] and any(i in interests for i in info["interests"]) and mood in info["mood"]:
            ì¢…í•©ì ìˆ˜ = random.randint(50,100)
            all_data.append([cat, item, info["desc"], ì¢…í•©ì ìˆ˜])

df = pd.DataFrame(all_data, columns=["ë¶„ì•¼","í•­ëª©","ì„¤ëª…","ì¢…í•©ì ìˆ˜"])

# ------------------ í˜ì´ì§€ ì œëª© ------------------
st.title("âœ¨ ë§ì¶¤í˜• ìœ í–‰ íŠ¸ë Œë“œ ë¶„ì„")
st.markdown(f"**ì—°ë ¹ëŒ€:** {age_group}, **í™˜ê²½:** {environment}, **ê´€ì‹¬ì‚¬:** {', '.join(interests)}, **ì‹¬ì •:** {mood}")

if df.empty:
    st.warning("í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” íŠ¸ë Œë“œê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ì‹¬ì‚¬ë‚˜ ì‹¬ì •ì„ ì¡°ì •í•´ë³´ì„¸ìš”!")
else:
    # ------------------ ë¶„ì•¼ë³„ TOP5 ------------------
    for cat in categories.keys():
        df_cat = df[df["ë¶„ì•¼"]==cat].sort_values("ì¢…í•©ì ìˆ˜", ascending=False).head(5)
        if not df_cat.empty:
            st.subheader(f"{cat} ë¶„ì•¼ TOP5 ğŸ”¥")
            for i, row in df_cat.iterrows():
                rank = df_cat.index.get_loc(i) + 1
                st.markdown(
                    f"""
                    <div style="background-color:#f9f9f9; padding:12px; margin:6px; border-radius:12px; 
                                box-shadow:2px 2px 6px rgba(0,0,0,0.1);">
                        <h4>ğŸ… {rank}ìœ„: <b>{row['í•­ëª©']}</b> ({row['ì¢…í•©ì ìˆ˜']}ì )</h4>
                        <p style="color:#555;">{row['ì„¤ëª…']}</p>
                    </div>
                    """, unsafe_allow_html=True
                )
            # ------------------ ë§‰ëŒ€ê·¸ë˜í”„ ì‘ê²Œ í‘œì‹œ ------------------
            st.bar_chart(df_cat.set_index("í•­ëª©")["ì¢…í•©ì ìˆ˜"], height=200)
