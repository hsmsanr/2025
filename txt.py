import streamlit as st
import pandas as pd
import random
import altair as alt

st.set_page_config(page_title="íŠ¸ë Œë“œ ì¶”ì²œ ì•±", page_icon="ğŸ”¥", layout="centered")

st.title("âœ¨ ë‚˜ì—ê²Œ ë§ëŠ” ìš”ì¦˜ íŠ¸ë Œë“œ âœ¨")
st.write("ì—°ë ¹ëŒ€, í™˜ê²½, ê´€ì‹¬ì‚¬, ì‹¬ì •ì„ ì…ë ¥í•˜ë©´ ë‹¹ì‹ ì—ê²Œ ë§ëŠ” íŠ¸ë Œë“œë¥¼ ë³´ì—¬ë“œë ¤ìš”!")

# -------------------------------
# ì„ íƒì§€ ì…ë ¥
# -------------------------------
age_group = st.selectbox("ì—°ë ¹ëŒ€ (ì„ íƒí•˜ì„¸ìš”)", ["ì„ íƒí•˜ì„¸ìš”", "10ëŒ€", "20ëŒ€", "30ëŒ€ ì´ìƒ"])
environment = st.selectbox("ì£¼ë³€ í™˜ê²½ (ì„ íƒí•˜ì„¸ìš”)", ["ì„ íƒí•˜ì„¸ìš”", "ë„ì‹œ", "êµì™¸", "í•™êµ", "ì§ì¥"])
interest = st.selectbox("ê´€ì‹¬ì‚¬ (ì„ íƒí•˜ì„¸ìš”)", ["ì„ íƒí•˜ì„¸ìš”", "íŒ¨ì…˜", "ìŒì‹", "ê²Œì„", "ë°ˆ/ìœ í–‰ì–´", "í•™êµìƒí™œ"])
mood = st.selectbox("í˜„ì¬ ì‹¬ì • (ì„ íƒí•˜ì„¸ìš”)", ["ì„ íƒí•˜ì„¸ìš”", "íë§ í•„ìš”", "ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ", "ì¬ë¯¸ ì°¾ëŠ” ì¤‘", "ê³µë¶€ ì§‘ì¤‘"])

# -------------------------------
# íŠ¸ë Œë“œ ë°ì´í„°ë² ì´ìŠ¤
# -------------------------------
trend_data = {
    "íŒ¨ì…˜": [
        {"name": "í¬ë¡ìŠ¤", "desc": "í¸ë¦¬í•¨ê³¼ ê¾¸ì•ˆê¾¸ íŒ¨ì…˜ìœ¼ë¡œ ìë¦¬ì¡ìŒ"},
        {"name": "ì¹´ê³  íŒ¬ì¸ ", "desc": "ì‹¤ìš©ì„±ê³¼ ìŠ¤íƒ€ì¼ì„ ë™ì‹œì—"},
        {"name": "ë¹ˆí‹°ì§€ íŒ¨ì…˜", "desc": "ê°œì„±ì„ ì‚´ë¦¬ëŠ” ë³µê³ í’"},
        {"name": "ë‰´ë°œë€ìŠ¤", "desc": "í¸ì•ˆí•¨ê³¼ íŠ¸ë Œë””í•¨"},
        {"name": "ì˜¤ë²„í• ì…”ì¸ ", "desc": "ììœ ë¡œìš´ ëŠë‚Œ ê°•ì¡°"}
    ],
    "ìŒì‹": [
        {"name": "ì œë¡œì½œë¼", "desc": "MZì„¸ëŒ€ í•„ìˆ˜í…œ"},
        {"name": "ë§ˆë¼íƒ•", "desc": "ì¤‘ë…ì„± ê°•í•œ ì–¼ì–¼í•œ ë§›"},
        {"name": "ë–¡ë³¶ì´", "desc": "ë¶ˆë³€ì˜ êµ­ë¯¼ ê°„ì‹"},
        {"name": "í¬ì¼€", "desc": "ê°€ë²¼ìš´ ê±´ê°•ì‹"},
        {"name": "í¸ì˜ì  ë„ì‹œë½", "desc": "ê°„í¸í•˜ê³  ê°€ì„±ë¹„ ì¢‹ìŒ"}
    ],
    "ê²Œì„": [
        {"name": "ë¡¤í† ì²´ìŠ¤", "desc": "ì „ëµì  ë‘ë‡Œ ì‹¸ì›€"},
        {"name": "ì˜¤ë²„ì›Œì¹˜2", "desc": "íŒ€í”Œë ˆì´ì˜ ë¬˜ë¯¸"},
        {"name": "ë§ˆì¸í¬ë˜í”„íŠ¸", "desc": "ë¬´ê¶ë¬´ì§„í•œ ì°½ì˜ë ¥ ë°œíœ˜"},
        {"name": "ë°°í‹€ê·¸ë¼ìš´ë“œ", "desc": "ì—¬ì „íˆ ëœ¨ê±°ìš´ ë°°í‹€ë¡œì–„"},
        {"name": "ì¿ í‚¤ëŸ° í‚¹ë¤", "desc": "ê·€ì—½ê³  ì¤‘ë…ì„± ê°•í•œ ê²Œì„"}
    ],
    "ë°ˆ/ìœ í–‰ì–´": [
        {"name": "ì§„ë˜ë°°ê¸° ë°ˆ", "desc": "ì¤‘ë…ì„± ê°•í•œ ìœ í–‰ ë°ˆ"},
        {"name": "ì‚¼ì©œì‚¼", "desc": "ì ˆì„¸ì™€ í™˜ê¸‰ ì„œë¹„ìŠ¤ë¡œ í™”ì œ"},
        {"name": "ê°œì´ë“", "desc": "ë“í…œì˜ ê¸°ì¨ í‘œí˜„"},
        {"name": "ì´ê²Œ ë‚˜ë¼ëƒ", "desc": "í’ìì™€ ë¹„íŒì˜ ìƒì§•"},
        {"name": "í‚¹ë°›ë„¤", "desc": "ë¶„ë…¸ì™€ ê·€ì—¬ì›€ ë™ì‹œì—"}
    ],
    "í•™êµìƒí™œ": [
        {"name": "ìŠ¤í„°ë””ì¹´í˜", "desc": "ê³µë¶€ ì§‘ì¤‘ ì„±ì§€"},
        {"name": "ê°¤ëŸ­ì‹œ íƒ­ í•„ê¸°", "desc": "ë””ì§€í„¸ ê³µë¶€ íˆ´"},
        {"name": "í•™êµ ì¶•ì œ ë°´ë“œë¶€", "desc": "ì—´ì •ê³¼ ë¬´ëŒ€ì˜ ìˆœê°„"},
        {"name": "ë™ì•„ë¦¬ í™œë™", "desc": "ìê¸°ê³„ë°œê³¼ ë„¤íŠ¸ì›Œí‚¹"},
        {"name": "ê¸‰ì‹ ë°ˆ", "desc": "ê³µê° ë°±ë°° í•™êµìƒí™œ ìœ ë¨¸"}
    ]
}

# -------------------------------
# ì…ë ¥ ì¡°ê±´ì— ë§ëŠ” íŠ¸ë Œë“œ ì¶”ì²œ
# -------------------------------
if age_group != "ì„ íƒí•˜ì„¸ìš”" and environment != "ì„ íƒí•˜ì„¸ìš”" and interest != "ì„ íƒí•˜ì„¸ìš”" and mood != "ì„ íƒí•˜ì„¸ìš”":
    st.subheader("ğŸ“Š ë‹¹ì‹ ì„ ìœ„í•œ íŠ¸ë Œë“œ ì¶”ì²œ")

    items = trend_data.get(interest, [])
    final_items = random.sample(items, k=min(5, len(items)))

    for idx, item in enumerate(final_items, 1):
        st.markdown(f"**{idx}. {item['name']}** - {item['desc']}")

    # -------------------------------
    # Altair ë§‰ëŒ€ê·¸ë˜í”„ (ìƒ‰ìƒ ë‹¤ì–‘ + ì‘ê²Œ)
    # -------------------------------
    df = pd.DataFrame({
        "í•­ëª©": [i["name"] for i in final_items],
        "ì¸ê¸°ë„ ì ìˆ˜": [len(final_items) - idx for idx, _ in enumerate(final_items)]
    })

    chart = (
        alt.Chart(df)
        .mark_bar(cornerRadiusTopLeft=6, cornerRadiusTopRight=6)
        .encode(
            x=alt.X("í•­ëª©:N", sort="-y", axis=alt.Axis(labelAngle=0)),
            y=alt.Y("ì¸ê¸°ë„ ì ìˆ˜:Q"),
            color=alt.Color("í•­ëª©:N", scale=alt.Scale(scheme="set2")),  # ìƒ‰ìƒ ë‹¤ì–‘
            tooltip=["í•­ëª©", "ì¸ê¸°ë„ ì ìˆ˜"]
        )
        .properties(width=400, height=250)  # í¬ê¸° ì‘ê²Œ
    )

    st.altair_chart(chart, use_container_width=True)

else:
    st.info("â¬†ï¸ ëª¨ë“  í•­ëª©ì„ ì„ íƒí•˜ë©´ íŠ¸ë Œë“œ ê²°ê³¼ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.")
