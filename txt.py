import streamlit as st
import pandas as pd
import random

st.set_page_config(page_title="ğŸ”¥ ìš”ì¦˜ ìœ í–‰ íŠ¸ë Œë“œ", layout="wide")

# ------------------ ë°ì´í„° ------------------
categories = {
    "ğŸ” ìŒì‹": {
        "ì œë¡œì½œë¼": "ì €ì¹¼ë¡œë¦¬ ì—´í’ê³¼ ê±´ê°• íŠ¸ë Œë“œ ë•ë¶„ì— ì¸ê¸° ìƒìŠ¹",
        "ì¼ë³¸ ë¼ë©˜": "SNS ìŒì‹ ë¦¬ë·°ë¡œ ìœ í–‰",
        "í•˜ì´ë³¼": "ì Šì€ ì¸µì—ì„œ ê°€ë³ê²Œ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ìˆ ",
        "í—¬ìŠ¤ ë³´ì¶©ì œ": "ìš´ë™ ì—´í’ìœ¼ë¡œ ìˆ˜ìš” ì¦ê°€",
        "ëª¬ìŠ¤í„° ì—ë„ˆì§€": "ê²Œì´ë¨¸Â·ìš´ë™ì¸ ì¤‘ì‹¬ í™•ì‚°"
    },
    "ğŸ‘— íŒ¨ì…˜": {
        "í¬ë¡ìŠ¤": "í¸ë¦¬í•¨ê³¼ ê¾¸ì•ˆê¾¸ íŒ¨ì…˜ìœ¼ë¡œ ìë¦¬ì¡ìŒ",
        "ìŠ¬ë¦¬í¼ íŒ¨ì…˜": "ì—¬ë¦„ì²  í¸í•œ ìŠ¤íƒ€ì¼ë¡œ ì¸ê¸°",
        "ì˜¤ë²„í• ì…”ì¸ ": "í™í•œ ê°ì„±ìœ¼ë¡œ ìœ í–‰",
        "ë²„í‚·í–‡": "ë ˆíŠ¸ë¡œ+ìŠ¤íŠ¸ë¦¿ íŒ¨ì…˜ì—ì„œ ì¬ì¡°ëª…",
        "ìƒŒë“¤": "ì—¬ë¦„ì²  í•„ìˆ˜ ì•„ì´í…œ"
    },
    "ğŸ¤£ ë°ˆ": {
        "ì§„ë˜ë°°ê¸° ë°ˆ": "ì¤‘ë…ì„± ê°•í•œ ë©œë¡œë””",
        "ë¬µì§í•˜ë‹¤ ë°ˆ": "ê²Œì„Â·ìŠ¤í¬ì¸  íŒ¨ëŸ¬ë”” ì¸ê¸°",
        "ê°“ìƒ ë°ˆ": "ìê¸°ê´€ë¦¬ ì—´í’ì„ í‘œí˜„",
        "ê´‘ê³ ì†¡ íŒ¨ëŸ¬ë””": "TVê´‘ê³  ë©œë¡œë””ê°€ ì˜¨ë¼ì¸ í™•ì‚°",
        "AI íŒ¨ëŸ¬ë””": "í•©ì„± ê¸°ìˆ ë¡œ ë§Œë“  ë°ˆ"
    },
    "ğŸŒŸ ì¸ë¬¼": {
        "ì´ê°•ì¸": "ì•„ì‹œì•ˆì»µ í™œì•½ìœ¼ë¡œ ê¸‰ìƒìŠ¹",
        "ë‰´ì§„ìŠ¤ ë¯¼ì§€": "K-POP ê¸€ë¡œë²Œ ì¸ê¸°",
        "ì†í¥ë¯¼": "EPL í™œì•½ê³¼ SNS í™”ì œ",
        "ì„ì˜ì›…": "íŠ¸ë¡œíŠ¸ ì—´í’+íŒ¬ë¤",
        "ì•„ì´ìœ ": "ë“œë¼ë§ˆÂ·ìŒì› ë™ì‹œ ì¸ê¸°"
    },
    "ğŸ’¡ ê¸°íƒ€": {
        "ì „ë™ í‚¥ë³´ë“œ": "ë„ì‹¬ ì´ë™ ìˆ˜ë‹¨",
        "ìº í•‘ìš©í’ˆ": "ì•¼ì™¸í™œë™ ì¦ê°€",
        "ë“œë¡  ì´¬ì˜": "SNS ì˜ìƒ ì œì‘",
        "ìŠ¤ë§ˆíŠ¸í™ˆ ê¸°ê¸°": "IoT ê¸°ìˆ  ë°œì „",
        "AR ì•ˆê²½": "ë©”íƒ€ë²„ìŠ¤ ì—´í’"
    }
}

# ------------------ ì ìˆ˜ ìƒì„± ------------------
all_data = []
for cat, items in categories.items():
    for item, desc in items.items():
        ì¢…í•©ì ìˆ˜ = random.randint(50,100)
        all_data.append([cat, item, desc, ì¢…í•©ì ìˆ˜])
df = pd.DataFrame(all_data, columns=["ë¶„ì•¼","í•­ëª©","ì„¤ëª…","ì¢…í•©ì ìˆ˜"])

# ------------------ ì…ë ¥ UI ------------------
st.title("âœ¨ ë§ì¶¤í˜• ìš”ì¦˜ ëœ¨ëŠ” íŠ¸ë Œë“œ ë¶„ì„")

st.markdown("ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´, ë‹¹ì‹ ì—ê²Œ ë”± ë§ëŠ” **ìµœì‹  íŠ¸ë Œë“œ TOP5**ë¥¼ ë³´ì—¬ë“œë ¤ìš”! ğŸš€")

col1, col2 = st.columns(2)
with col1:
    age = st.selectbox("ì—°ë ¹ëŒ€ (ì„ íƒì§€: ì„ íƒí•˜ì„¸ìš” âœ¨)", ["ì„ íƒí•˜ì„¸ìš”", "10ëŒ€", "20ëŒ€", "30ëŒ€", "40ëŒ€ ì´ìƒ"])
    env = st.selectbox("ì£¼ë³€í™˜ê²½ (ì„ íƒì§€: ì„ íƒí•˜ì„¸ìš” âœ¨)", ["ì„ íƒí•˜ì„¸ìš”", "ë„ì‹œ", "êµì™¸", "í•™êµ", "ì§ì¥"])
with col2:
    interest = st.selectbox("ê´€ì‹¬ì‚¬ (ì„ íƒì§€: ì„ íƒí•˜ì„¸ìš” âœ¨)", ["ì„ íƒí•˜ì„¸ìš”", "ìŒì‹", "íŒ¨ì…˜", "ë°ˆ", "ì¸ë¬¼", "ê¸°íƒ€"])
    mood = st.selectbox("í˜„ì¬ ì‹¬ì • (ì„ íƒì§€: ì„ íƒí•˜ì„¸ìš” âœ¨)", ["ì„ íƒí•˜ì„¸ìš”", "ì¦ê±°ì›€", "í”¼ê³¤í•¨", "íë§ í•„ìš”", "ìê¸°ê³„ë°œ", "ìœ ë¨¸ ì°¾ëŠ” ì¤‘"])

# ------------------ í•„í„°ë§ ------------------
filtered_df = df.copy()

if age != "ì„ íƒí•˜ì„¸ìš”":
    if age == "10ëŒ€":  
        filtered_df = filtered_df[~filtered_df["í•­ëª©"].isin(["í•˜ì´ë³¼","í—¬ìŠ¤ ë³´ì¶©ì œ"])]
    elif age == "40ëŒ€ ì´ìƒ":
        filtered_df = filtered_df[~filtered_df["í•­ëª©"].isin(["AI íŒ¨ëŸ¬ë””","ë²„í‚·í–‡"])]

if interest != "ì„ íƒí•˜ì„¸ìš”":
    filtered_df = filtered_df[filtered_df["ë¶„ì•¼"].str.contains(interest[0])]

if mood != "ì„ íƒí•˜ì„¸ìš”":
    if mood == "ìœ ë¨¸ ì°¾ëŠ” ì¤‘":
        filtered_df = filtered_df[filtered_df["ë¶„ì•¼"]=="ğŸ¤£ ë°ˆ"]
    elif mood == "íë§ í•„ìš”":
        filtered_df = filtered_df[filtered_df["ë¶„ì•¼"].isin(["ğŸ” ìŒì‹","ğŸ’¡ ê¸°íƒ€"])]

# ------------------ ê²°ê³¼ ------------------
st.subheader("ğŸ¯ ë§ì¶¤í˜• íŠ¸ë Œë“œ TOP5")

if filtered_df.empty:
    st.warning("âš ï¸ ì¡°ê±´ì— ë§ëŠ” íŠ¸ë Œë“œê°€ ì—†ì–´ìš”! ì„ íƒì§€ë¥¼ ë°”ê¿”ë³´ì„¸ìš”.")
else:
    result = filtered_df.sort_values("ì¢…í•©ì ìˆ˜", ascending=False).head(5)

    for i, row in result.iterrows():
        rank = result.index.get_loc(i) + 1
        st.markdown(
            f"""
            <div style="background-color:#f9f9f9; padding:12px; margin:6px; border-radius:12px; 
                        box-shadow:2px 2px 6px rgba(0,0,0,0.1); margin-bottom:10px;">
                <h4>ğŸ… {rank}ìœ„: <b>{row['í•­ëª©']}</b> ({row['ì¢…í•©ì ìˆ˜']}ì )</h4>
                <p style="color:#555;">{row['ì„¤ëª…']}</p>
            </div>
            """, unsafe_allow_html=True
        )

    st.bar_chart(result.set_index("í•­ëª©")["ì¢…í•©ì ìˆ˜"])

# ------------------ ê²°ê³¼ ------------------
st.subheader("ğŸ¯ ë§ì¶¤í˜• íŠ¸ë Œë“œ TOP5")

if filtered_df.empty:
    st.warning("âš ï¸ ì¡°ê±´ì— ë§ëŠ” íŠ¸ë Œë“œê°€ ì—†ì–´ìš”! ì„ íƒì§€ë¥¼ ë°”ê¿”ë³´ì„¸ìš”.")
else:
    result = filtered_df.sort_values("ì¢…í•©ì ìˆ˜", ascending=False).head(5)

    for i, row in result.iterrows():
        rank = result.index.get_loc(i) + 1
        st.markdown(
            f"""
            <div style="background-color:#f9f9f9; padding:12px; margin:6px; border-radius:12px; 
                        box-shadow:2px 2px 6px rgba(0,0,0,0.1); margin-bottom:10px;">
                <h4>ğŸ… {rank}ìœ„: <b>{row['í•­ëª©']}</b> ({row['ì¢…í•©ì ìˆ˜']}ì )</h4>
                <p style="color:#555;">{row['ì„¤ëª…']}</p>
            </div>
            """, unsafe_allow_html=True
        )

    # ë°” ì°¨íŠ¸ (í•­ëª© ì´ë¦„ ê¸°ì¤€ìœ¼ë¡œ ì¶œë ¥)
    st.bar_chart(result.set_index("í•­ëª©")["ì¢…í•©ì ìˆ˜"])
