import streamlit as st
import matplotlib.pyplot as plt

# ---------------------------
# íŠ¸ë Œë“œ ë°ì´í„° ì˜ˆì‹œ
# ---------------------------
trends = {
    "10ëŒ€": {
        "íŒ¨ì…˜": [
            {"ì´ë¦„": "í¬ë¡ìŠ¤", "ì„¤ëª…": "í¸ë¦¬í•¨ê³¼ ê¾¸ì•ˆê¾¸ íŒ¨ì…˜ìœ¼ë¡œ ìë¦¬ì¡ìŒ"},
            {"ì´ë¦„": "ì¹´ê³ ë°”ì§€", "ì„¤ëª…": "í™í•˜ê³  í¸ì•ˆí•œ ìŠ¤íƒ€ì¼ë¡œ ì¸ê¸°ë¥¼ ì–»ìŒ"},
            {"ì´ë¦„": "ë‰´ì§„ìŠ¤ ìŠ¤íƒ€ì¼", "ì„¤ëª…": "ì•„ì´ëŒ íŒ¨ì…˜ì´ ìœ í–‰ì„ ì„ ë„"},
            {"ì´ë¦„": "ì™€ì´ë“œ íŒ¬ì¸ ", "ì„¤ëª…": "í¸ì•ˆí•¨ê³¼ íŠ¸ë Œë””í•¨ì„ ë™ì‹œì— ì¶”êµ¬"},
            {"ì´ë¦„": "í¬ë¡­í‹°", "ì„¤ëª…": "ì—¬ë¦„ì²  íŒ¨ì…˜ ì•„ì´í…œìœ¼ë¡œ ìë¦¬ë§¤ê¹€"}
        ],
        "ìŒì‹": [
            {"ì´ë¦„": "ë§ˆë¼íƒ•", "ì„¤ëª…": "ì¤‘êµ­ì‹ ì–¼ì–¼í•œ ë§¤ìš´ë§›ìœ¼ë¡œ ì¸ê¸°"},
            {"ì´ë¦„": "ë¶„ì‹ ë°°ë‹¬", "ì„¤ëª…": "ê°„í¸í•˜ë©´ì„œ ê°€ì„±ë¹„ ì¢‹ì€ í•œ ë¼"},
            {"ì´ë¦„": "ëŒ€ì™• ëˆê°€ìŠ¤", "ì„¤ëª…": "ì¸ìŠ¤íƒ€ ì¸ì¦ìƒ· ìŒì‹ìœ¼ë¡œ ì¸ê¸°"},
            {"ì´ë¦„": "ë¹™ìˆ˜", "ì„¤ëª…": "ì—¬ë¦„ì²  ëŒ€í‘œ ë””ì €íŠ¸ë¡œ ë¶€ìƒ"},
            {"ì´ë¦„": "ë–¡ë³¶ì´ í“¨ì „", "ì„¤ëª…": "ì´ìƒ‰ ì¡°í•©ìœ¼ë¡œ SNSì—ì„œ í™”ì œ"}
        ],
        "ë°ˆ/ìœ í–‰ì–´": [
            {"ì´ë¦„": "ì§„ë˜ë°°ê¸°", "ì„¤ëª…": "ë°ˆìœ¼ë¡œ í¼ì§€ë©° ë‹¤ì–‘í•œ íŒ¨ëŸ¬ë”” ìœ í–‰"},
            {"ì´ë¦„": "ê°“ìƒì‚´ê¸°", "ì„¤ëª…": "ìê¸°ê³„ë°œ ì—´í’ì„ ë°˜ì˜"},
            {"ì´ë¦„": "ìŠ¤ë¶ˆì¬", "ì„¤ëª…": "ìŠ¤ìŠ¤ë¡œ ë¶ˆëŸ¬ì˜¨ ì¬ì•™ì„ ëœ»í•˜ë©° ê³µê°ëŒ€ í˜•ì„±"},
            {"ì´ë¦„": "í‚¹ë°›ë„¤", "ì„¤ëª…": "í™”ë‚  ë•Œ ì“°ëŠ” ìœ ë¨¸ëŸ¬ìŠ¤í•œ í‘œí˜„"},
            {"ì´ë¦„": "ë‹¹ê·¼ì´ì„¸ìš”?", "ì„¤ëª…": "ì¤‘ê³ ê±°ë˜ í”Œë«í¼ì—ì„œ ìœ ë˜"}
        ],
        "ì¸ë¬¼": [
            {"ì´ë¦„": "ë‰´ì§„ìŠ¤", "ì„¤ëª…": "10ëŒ€ ë¬¸í™”ë¥¼ ì„ ë„í•˜ëŠ” ì•„ì´ëŒ ê·¸ë£¹"},
            {"ì´ë¦„": "ì•„ì´ë¸Œ", "ì„¤ëª…": "ì„¸ë ¨ëœ ì´ë¯¸ì§€ì™€ ìŒì•…ìœ¼ë¡œ ì¸ê¸°"},
            {"ì´ë¦„": "ì†í¥ë¯¼", "ì„¤ëª…": "êµ­ë¯¼ì ì¸ ìŠ¤í¬ì¸  ìŠ¤íƒ€"},
            {"ì´ë¦„": "ì„ì˜ì›…", "ì„¤ëª…": "ì„¸ëŒ€ë¥¼ ì•„ìš°ë¥´ëŠ” ê°€ìˆ˜"},
            {"ì´ë¦„": "ì•ˆìœ ì§„", "ì„¤ëª…": "ì˜ˆëŠ¥ê³¼ ìŒì•…ì—ì„œ ë‘ê°ì„ ë‚˜íƒ€ëƒ„"}
        ]
    }
}

# ---------------------------
# ì˜ˆìœ ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜
# ---------------------------
def draw_bar_chart(data, title):
    names = [d["ì´ë¦„"] for d in data]
    values = list(range(len(data), 0, -1))  # 5,4,3,2,1 ë­í‚¹ ê°’
    
    colors = plt.cm.Paired(range(len(data)))  # ë‹¤ì–‘í•œ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì ìš©
    
    fig, ax = plt.subplots(figsize=(5, 3))  # í¬ê¸° ì‘ê²Œ
    bars = ax.bar(names, values, color=colors, width=0.6)
    
    # ì œëª© & ë¼ë²¨
    ax.set_title(title, fontsize=14, fontweight="bold")
    ax.set_ylabel("ì¸ê¸° ìˆœìœ„", fontsize=10)
    ax.set_xticks(range(len(names)))
    ax.set_xticklabels(names, rotation=20, ha="right", fontsize=9)
    ax.set_yticks(range(1, len(data)+1))
    ax.set_yticklabels(list(range(5, 0, -1)))  # 1ìœ„~5ìœ„
    
    # ê° ë§‰ëŒ€ ìœ„ì— ìˆœìœ„ í‘œì‹œ
    for bar, rank in zip(bars, range(1, len(data)+1)):
        ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1, f"{rank}ìœ„",
                ha='center', va='bottom', fontsize=9, fontweight="bold")
    
    st.pyplot(fig)

# ---------------------------
# Streamlit UI
# ---------------------------
st.set_page_config(page_title="ìµœì‹  íŠ¸ë Œë“œ TOP5", layout="centered")

st.title("âœ¨ ë‚˜ì—ê²Œ ë§ëŠ” ìµœì‹  íŠ¸ë Œë“œ TOP 5 âœ¨")

# ì‚¬ìš©ì ì…ë ¥
age = st.selectbox("ì—°ë ¹ëŒ€ (ì„ íƒí•˜ì„¸ìš”)", ["ì„ íƒí•˜ì„¸ìš”", "10ëŒ€", "20ëŒ€", "30ëŒ€ ì´ìƒ"])
interest = st.selectbox("ê´€ì‹¬ ë¶„ì•¼ (ì„ íƒí•˜ì„¸ìš”)", ["ì„ íƒí•˜ì„¸ìš”", "íŒ¨ì…˜", "ìŒì‹", "ë°ˆ/ìœ í–‰ì–´", "ì¸ë¬¼"])

if age != "ì„ íƒí•˜ì„¸ìš”" and interest != "ì„ íƒí•˜ì„¸ìš”":
    if age in trends and interest in trends[age]:
        data = trends[age][interest][:5]  # 5ê°œë§Œ ê°€ì ¸ì˜¤ê¸°
        st.subheader(f"ğŸ“Œ {age}ì˜ {interest} íŠ¸ë Œë“œ TOP 5")
        
        # ì„¤ëª… ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
        for idx, item in enumerate(data, 1):
            st.markdown(f"**{idx}ìœ„. {item['ì´ë¦„']}** - {item['ì„¤ëª…']}")
        
        # ê·¸ë˜í”„ ì¶œë ¥
        draw_bar_chart(data, f"{interest} TOP 5")
    else:
        st.warning("í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” íŠ¸ë Œë“œ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.")
else:
    st.info("ì—°ë ¹ëŒ€ì™€ ê´€ì‹¬ ë¶„ì•¼ë¥¼ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.")
